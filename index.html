<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Statistics With Software Tools 2025 ‚Äì Final Exam (100 Questions)</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        .animate-fadeIn {
            animation: fadeIn .4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Disable text selection / copy */
        * {
            user-select: none !important;
            -webkit-user-select: none !important;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- COPY / RIGHT-CLICK BLOCK -->
<script>
document.addEventListener("contextmenu", e => e.preventDefault());
document.addEventListener("keydown", e => {
    if (e.ctrlKey && ["c","x","a","s"].includes(e.key.toLowerCase())) {
        e.preventDefault();
    }
});
</script>


<!-- ============================= -->
<!-- LOGIN SCREEN ‚Üí NEXT: instructions -->
<!-- ============================= -->
<div id="loginScreen" class="min-h-screen flex items-center justify-center p-6">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full animate-fadeIn">

        <h1 class="text-4xl text-center font-bold text-purple-600 mb-2">Statistics Challenge</h1>
        <p class="text-center text-gray-600 mb-8">Final Examination 2025</p>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Name</label>
                <input id="studentName" class="w-full px-4 py-3 border rounded-lg">
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Student ID</label>
                <input id="studentId" class="w-full px-4 py-3 border rounded-lg">
            </div>

            <button onclick="showInstructions()"
                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg text-lg">
                Continue
            </button>
        </div>

        <p class="text-xs text-center mt-4 text-gray-500">
            Instructions will appear before the exam begins.
        </p>
    </div>
</div>


<!-- ============================= -->
<!-- INSTRUCTION MODAL (after login) -->
<!-- ============================= -->
<div id="instructionModal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-6 z-50">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8 animate-fadeIn">

        <h2 class="text-3xl font-bold text-purple-600 mb-4 text-center">
            üìò Statistics Challenge 2025 ‚Äì Instructions
        </h2>

        <p class="text-gray-700 mb-4">
            Please read the instructions carefully before starting the exam.
        </p>

        <ul class="border-l-4 border-purple-400 bg-purple-50 p-4 rounded mb-6 list-disc ml-6 text-sm text-gray-700">
            <li>100 multiple-choice concept questions</li>
            <li>20 seconds per question</li>
            <li>Total exam time: 33 minutes 20 seconds (2000 seconds)</li>
            <li>No retakes ‚Äì only one attempt per student</li>
            <li>Exam available Dec 5 9:00 AM ‚Üí Dec 9 9:00 PM</li>
            <li>Questions auto-advance (no navigation buttons)</li>
            <li>Questions appear in a unique random order for each student</li>
        </ul>

        <div class="flex items-center gap-2 mb-6">
            <input id="agreeCheck" type="checkbox" class="w-5 h-5">
            <label for="agreeCheck" class="text-gray-800 text-sm">
                I have read and fully understand the exam instructions.
            </label>
        </div>

        <div class="text-center">
            <button id="startExamBtn"
                    disabled
                    class="bg-gray-400 cursor-not-allowed text-white font-bold px-8 py-3 rounded-xl transition">
                Start Exam
            </button>
        </div>
    </div>
</div>

<script>
// LOGIN ‚Üí SHOW INSTRUCTIONS
function showInstructions() {
    const name = document.getElementById("studentName").value.trim();
    const id = document.getElementById("studentId").value.trim();

    if (!name || !id) {
        alert("Please enter your name and student ID.");
        return;
    }

    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("instructionModal").classList.remove("hidden");
}

// ENABLE BUTTON IF CHECKED
document.getElementById("agreeCheck").addEventListener("change", () => {
    const btn = document.getElementById("startExamBtn");
    if (agreeCheck.checked) {
        btn.disabled = false;
        btn.classList.remove("bg-gray-400");
        btn.classList.remove("cursor-not-allowed");
        btn.classList.add("bg-purple-600", "hover:bg-purple-700");
    } else {
        btn.disabled = true;
        btn.classList.add("bg-gray-400", "cursor-not-allowed");
        btn.classList.remove("bg-purple-600", "hover:bg-purple-700");
    }
});
</script>
<!-- ============================= -->
<!-- EXAM SCREEN -->
<!-- ============================= -->
<div id="examScreen" class="hidden min-h-screen p-4">

    <!-- Header -->
    <div class="bg-white rounded-lg shadow-lg p-4 mb-4 sticky top-4 z-10">
        <div class="flex justify-between items-center">

            <!-- Student Info -->
            <div>
                <h2 class="text-xl font-bold" id="studentInfo"></h2>
                <p class="text-sm text-gray-600">Statistics Challenge 2025 ‚Äì Final Exam</p>
            </div>

            <!-- Timer -->
            <div class="text-right">
                <div class="text-sm text-gray-500 mb-1">Total Time (33m 20s)</div>
                <div id="timer" class="text-3xl font-bold text-purple-600">33:20</div>
                <p class="text-xs text-gray-500 mt-1">20 seconds per question</p>
            </div>
        </div>
    </div>

    <!-- Question Container -->
    <div id="questionContainer" class="mb-6"></div>

</div>


<!-- ============================= -->
<!-- RESULT SCREEN -->
<!-- ============================= -->
<div id="resultScreen" class="hidden min-h-screen flex items-center justify-center p-6">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full">

        <div class="text-center mb-8">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-3xl font-bold mb-2">Your Exam is Complete!</h2>
            <p class="text-gray-600">Your responses have been successfully recorded.</p>
        </div>

        <div id="resultContent" class="space-y-4"></div>

        <div class="text-center mt-10">
            <button onclick="location.reload()"
                    class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg transition">
                Return to Home
            </button>
        </div>

    </div>
</div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
/* ============================================================
   FIREBASE INIT
============================================================ */
const firebaseConfig = {
    apiKey: "AIzaSyBGd_KrhvdCfxeRPcXn7f8csLUfcZkmKVs",
    authDomain: "sswt-final.firebaseapp.com",
    projectId: "sswt-final",
    storageBucket: "sswt-final.firebasestorage.app",
    messagingSenderId: "824707188580",
    appId: "1:824707188580:web:747ba4d91ab781e1a15c71"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ============================================================
   GLOBAL STATE
============================================================ */
let TOTAL_TIME = 2000; // 33Î∂Ñ 20Ï¥à = 2000Ï¥à
let questions = [];
let currentIndex = 0;
let answers = [];
let examStartTime = null;
let studentName = "";
let studentId = "";
const EXAM_DOC_ID = "current";

/* ============================================================
   LOAD QUESTIONS FROM FIRESTORE
============================================================ */
async function loadQuestions(docId = EXAM_DOC_ID) {
    try {
        const snap = await db.collection("exam_questions").doc(docId).get();

        if (!snap.exists) {
            alert("‚ùå Exam questions not found.");
            return false;
        }

        let raw = snap.data().questions;

        // Î∞∞Ïó¥ or object ‚Üí Î¨¥Ï°∞Í±¥ Î∞∞Ïó¥Î°ú Î≥ÄÌôò
        questions = Array.isArray(raw) ? raw : Object.values(raw);

        // 100Î¨∏Ï†úÎßå ÏÇ¨Ïö©ÌïúÎã§Í≥† Í∞ÄÏ†ï
        if (questions.length < 1) {
            alert("‚ùå No questions available.");
            return false;
        }

        return true;

    } catch (err) {
        console.error(err);
        alert("‚ùå Failed to load exam questions.");
        return false;
    }
}

/* ============================================================
   SHUFFLE QUESTIONS (Í∞Å ÌïôÏÉùÎßàÎã§ ÏàúÏÑú Îã§Î•¥Í≤å)
============================================================ */
function shuffle(array) {
    let a = [...array];
    for (let i = a.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

/* ============================================================
   ATTEMPT CHECK (Ïû¨ÏùëÏãú Í∏àÏßÄ)
============================================================ */
async function verifyAttempt(studentId) {
    try {
        const doc = await db.collection("exam_responses").doc(studentId).get();
        return doc.exists ? false : true;
    } catch (err) {
        console.error(err);
        return true;
    }
}

/* ============================================================
   START EXAM
============================================================ */
async function startExam() {

    studentName = document.getElementById("studentName").value.trim();
    studentId   = document.getElementById("studentId").value.trim();

    if (!studentName || !studentId) {
        alert("Please enter your name and student ID.");
        return;
    }

    // 1 attempt ONLY
    const ok = await verifyAttempt(studentId);
    if (!ok) {
        alert("‚ö† You have already taken this exam. Retake is not allowed.");
        return;
    }

    // Load questions
    const loaded = await loadQuestions(EXAM_DOC_ID);
    if (!loaded) return;

    // Shuffle questions
    questions = shuffle(questions);

    // Set up exam
    currentIndex = 0;
    answers = new Array(questions.length).fill(null);
    examStartTime = Date.now();

    // Hide login, show exam screen
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("examScreen").classList.remove("hidden");

    // Render timer + first question
    startTimer();
    showQuestion();
}

/* ============================================================
   TIMER
============================================================ */
function startTimer() {
    let remaining = TOTAL_TIME;

    let timer = setInterval(() => {
        remaining--;

        let mm = String(Math.floor(remaining / 60)).padStart(2,'0');
        let ss = String(remaining % 60).padStart(2,'0');

        document.getElementById("timeLeft").textContent = `${mm}:${ss}`;

        if (remaining <= 0) {
            clearInterval(timer);
            finishExam();
        }
    }, 1000);
}

/* ============================================================
   RENDER QUESTION
============================================================ */
function showQuestion() {
    const q = questions[currentIndex];

    if (!q) return;

    document.getElementById("questionNumber").textContent =
        `Question ${currentIndex+1} / ${questions.length}`;

    document.getElementById("questionText").textContent = q.text;

    const opts = q.options;

    document.getElementById("opt1label").textContent = opts[0];
    document.getElementById("opt2label").textContent = opts[1];
    document.getElementById("opt3label").textContent = opts[2];
    document.getElementById("opt4label").textContent = opts[3];

    // restore selection
    let saved = answers[currentIndex];
    document.querySelectorAll("input[name='choice']").forEach(r => {
        r.checked = (parseInt(r.value) === saved);
    });
}

/* ============================================================
   RECORD ANSWER & NEXT
============================================================ */
function nextQuestion() {
    const selected = document.querySelector("input[name='choice']:checked");

    if (!selected) {
        alert("Please select an answer.");
        return;
    }

    answers[currentIndex] = parseInt(selected.value);

    currentIndex++;

    if (currentIndex >= questions.length) {
        finishExam();
        return;
    }

    document.querySelectorAll("input[name='choice']").forEach(r => r.checked = false);

    showQuestion();
}

/* ============================================================
   SUBMIT ANSWERS
============================================================ */
async function finishExam() {
    // Score
    let score = 0;
    for (let i = 0; i < questions.length; i++) {
        if (answers[i] === questions[i].answer) score++;
    }

    let result = {
        studentId,
        name: studentName,
        score,
        selectedAnswers: answers,
        correctAnswers: questions.map(q => q.answer),
        version: EXAM_DOC_ID,
        timestamp: new Date().toISOString()
    };

    try {
        await db.collection("exam_responses").doc(studentId).set(result);

        document.getElementById("examScreen").classList.add("hidden");
        document.getElementById("finishScreen").classList.remove("hidden");

        document.getElementById("finalScore").textContent = score;

    } catch (err) {
        console.error(err);
        alert("‚ùå Failed to submit exam.");
    }
}
</script>


</body>
</html>
